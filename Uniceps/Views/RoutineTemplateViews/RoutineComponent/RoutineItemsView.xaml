<UserControl x:Class="Uniceps.Views.RoutineTemplateViews.RoutineComponent.RoutineItemsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Uniceps.Views.RoutineTemplateViews.RoutineComponent"
             mc:Ignorable="d" 
             FlowDirection="RightToLeft"
               xmlns:Comp="clr-namespace:Uniceps.utlis.Components"
  xmlns:converters="clr-namespace:Uniceps.utlis.Converters"
             xmlns:icons="http://metro.mahapps.com/winfx/xaml/iconpacks"
             
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.InputBindings>
        <!-- زر Up يحرك العنصر المحدد للأعلى -->
        <KeyBinding Key="Up" Modifiers="Alt"
             Command="{Binding MoveUpCommand}"
             CommandParameter="{Binding SelectedRoutineItem}" />

        <!-- زر Down يحرك العنصر المحدد للأسفل -->
        <KeyBinding Key="Down" Modifiers="Alt"
             Command="{Binding MoveDownCommand}"
             CommandParameter="{Binding SelectedRoutineItem}" />

        <KeyBinding Key="A" Modifiers="Ctrl"
      Command="{Binding OpenExercisesCommand}" />
    </UserControl.InputBindings>
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="boolToVis"/>
        <converters:InverseBooleanToVisibalityConverter x:Key="InverseBooleanToVisibalityConverter"/>
    </UserControl.Resources>
    <Border Grid.ColumnSpan="2" Margin="10 0" Grid.Row="2" Style="{DynamicResource StaticCardBorderStyle}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid Grid.ColumnSpan="2" Grid.Column="0" Margin="0 0 0 10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="التمارين الرياضية" VerticalAlignment="Center" Foreground="{DynamicResource Brush.Foreground}" FontSize="16"  Margin="0 0 8 0"/>
                <Button Style="{StaticResource AddBtn}" VerticalAlignment="Center" ToolTip="Ctrl + A" Margin="10 0" Grid.Column="2" Command="{Binding OpenExercisesCommand}" Width="100">
                    <TextBlock Text="أضافة تمارين"/>
                </Button>
                <StackPanel Grid.Column="1" VerticalAlignment="Center" Orientation="Horizontal" >
                    <Button 
Command="{Binding MoveUpCommand}" ToolTip="Alt + Up "
CommandParameter="{Binding SelectedRoutineItem}" Style="{DynamicResource BorderedIconBtn}">
                        <icons:PackIconMaterial Kind="ArrowUp"/>
                    </Button>
                    <Button  Margin="5 0"
Command="{Binding MoveDownCommand}" VerticalAlignment="Center" ToolTip="Alt + Down "
CommandParameter="{Binding SelectedRoutineItem}"  Style="{DynamicResource BorderedIconBtn}">
                        <icons:PackIconMaterial Kind="ArrowDown"/>
                    </Button>
                    <Button Grid.Column="2" VerticalAlignment="Center" Grid.Row="1" Visibility="{Binding HasOrderChanged,Converter={StaticResource boolToVis}}" Command="{Binding SaveNewOrderCommand}" Style="{StaticResource BorderedIconBtn}">
                        <TextBlock Text="حفظ ترتيب التمارين"/>
                    </Button>
                    <Button Grid.Column="2" VerticalAlignment="Center" Grid.Row="1" Margin="10 0" Command="{Binding ApplySetsToAllCommand}" Style="{StaticResource BorderedIconBtn}">
                        <TextBlock Text=" تطبيق الجولات للكل"/>
                    </Button>
                </StackPanel>
            </Grid>
          
            <Border  Grid.Row="2" Grid.Column="0"  >
            <DataGrid FlowDirection="RightToLeft" ItemsSource="{Binding RoutineItems}" 
CanUserReorderColumns="True" SelectedItem="{Binding SelectedRoutineItem}"
x:Name="PlayerDataGrid" 
                       PreviewKeyDown="PlayerDataGrid_PreviewKeyDown" Style="{DynamicResource DataGridStyle1}"   
  RowStyle="{StaticResource DataGridRowStyle1}" 
CellStyle="{DynamicResource DataGridCellStyle1}" VirtualizingPanel.ScrollUnit="Pixel"
ColumnHeaderStyle="{DynamicResource DataGridColumnHeaderStyle1}">
                   
                <DataGrid.Columns> 
                    <DataGridTextColumn Header="#" IsReadOnly="True"
Width="auto"
Binding="{Binding Order}"
CanUserResize="False"/>
                        <DataGridTemplateColumn  Width="auto" IsReadOnly="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" x:Name="menu">
                                        <Button Command="{Binding DeleteCommand}"  Style="{StaticResource EditBtn}">
                                            <icons:PackIconMaterial Kind="TrashCan"/>
                                        </Button>
                                        <Button Margin="10 0"   Command="{Binding DataContext.AddSetsCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
CommandParameter="{Binding}"   Style="{StaticResource EditBtn}">
                                            <StackPanel Orientation="Horizontal">
                                                <icons:PackIconMaterial VerticalAlignment="Center" Kind="Plus"/>
                                                <TextBlock VerticalAlignment="Center" Text="اضافة جولات" Margin="5 0"/>
                                            </StackPanel>
                                        </Button>
                                    
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="الصورة" Width="auto" IsReadOnly="True">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Image Width="100"
                                 Source="{Binding ExerciseImage}"
                                 RenderOptions.BitmapScalingMode="HighQuality"
                                 RenderOptions.EdgeMode="Aliased"
                                 Height="100" DockPanel.Dock="Top"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="اسم التمرين" IsReadOnly="True"
 Binding="{Binding ExerciseName}"
Width="auto"
/>
                        <DataGridTextColumn Header="الجولات" IsReadOnly="True"
 Binding="{Binding SetsString}"
Width="*"
/>
                       
                </DataGrid.Columns>
            </DataGrid>
            </Border>
            <Comp:CaptinRoutineItemEmpty Visibility="{Binding HasData,Converter={StaticResource InverseBooleanToVisibalityConverter}}" Grid.Row="2" Title="لا يوجد تمارين بعد" 
            Caption="اضغط على زر اضافة تمارين واختر التمارين المناسبة"/>
        </Grid>
    </Border>

</UserControl>
